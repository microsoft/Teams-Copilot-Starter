# yaml-language-server: $schema=https://aka.ms/teams-toolkit/v1.3/yaml.schema.json
# Visit https://aka.ms/teamsfx-v5.0-guide for details on this file
# Visit https://aka.ms/teamsfx-actions for details on actions
version: v1.3

deploy:
  # Install development tool(s)
  - uses: devTool/install
    with:
      testTool:
        version: ~0.2.1-beta
        symlinkDir: ./devTools/teamsapptester

  # Run npm command for TeamsFx project
  - uses: cli/runNpmCommand
    with:
      args: install --no-audit

  # Generate runtime environment variables for bot
  - uses: file/createOrUpdateEnvironmentFile
    with:
      target: ./src/.localConfigs.testTool
      envs:
        TEAMSFX_NOTIFICATION_STORE_FILENAME: ${{TEAMSFX_NOTIFICATION_STORE_FILENAME}}
        TEAMSFX_ENV: ${{TEAMSFX_ENV}}
        APP_VERSION: ${{APP_VERSION}}
        AAD_APP_CLIENT_ID: ${{AAD_APP_CLIENT_ID}}
        AAD_APP_CLIENT_SECRET: ${{SECRET_AAD_APP_CLIENT_SECRET}}
        AAD_APP_TENANT_ID: ${{AAD_APP_TENANT_ID}}
        AAD_APP_OAUTH_AUTHORITY_HOST: ${{AAD_APP_OAUTH_AUTHORITY_HOST}}
        M365_TITLE_ID: ${{M365_TITLE_ID}}
        M365_APP_ID: ${{M365_APP_ID}}
        OPENAI_KEY: ${{OPENAI_KEY}}
        OPENAI_ENDPOINT: ${{OPENAI_ENDPOINT}}
        OPENAI_MODEL: ${{OPENAI_MODEL}}
        OPENAI_EMBEDDING_MODEL: ${{OPENAI_EMBEDDING_MODEL}}
        STORAGE_ACCOUNT_NAME: ${{STORAGE_ACCOUNT_NAME}}
        STORAGE_ACCOUNT_KEY: ${{STORAGE_ACCOUNT_KEY}}
        OPENAI_API_VERSION: ${{OPENAI_API_VERSION}}
        VECTRA_INDEX_PATH: ${{VECTRA_INDEX_PATH}}
        DEFAULT_PROMPT_NAME: ${{DEFAULT_PROMPT_NAME}}
        STORAGE_CONTAINER_NAME: ${{STORAGE_CONTAINER_NAME}}
        WEBDATA_SOURCE_NAME: ${{WEBDATA_SOURCE_NAME}}
        DOCUMENTDATA_SOURCE_NAME: ${{DOCUMENTDATA_SOURCE_NAME}}
        MAX_TURNS: ${{MAX_TURNS}}
        MAX_FILE_SIZE: ${{MAX_FILE_SIZE}}
        MAX_PAGES: ${{MAX_PAGES}}
